<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.befb8cd0446e12ce56a6.css">@import url(https://fonts.googleapis.com/css?family=Heebo&display=swap);code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.link-module--wrapper--2dAz0{margin-bottom:30px}.link-module--linkTitle--3VUWq{border-bottom:1px solid #3997dc;color:#32404b;display:inline-block;font-size:20px;font-weight:700;margin-bottom:10px;text-decoration:none}.link-module--linkTitle--3VUWq:hover{color:#3997dc}.link-module--title--3H5Ml{color:#32404b;display:inline-block;font-size:20px;font-weight:700;margin-bottom:10px}.link-module--desc--2JcNe{font-size:16px}.socials-module--list--nQjwE{margin:15px 0 0;padding:0}.socials-module--item--2qCBJ{display:inline-block;list-style:none;margin-right:20px}.socials-module--link--m0nMJ{color:#787a82;text-decoration:none}.socials-module--link--m0nMJ:hover{color:#3997dc}.header-module--headerWrapper--15qHx{display:flex;margin-bottom:100px}.header-module--profileWrapper--17Lox{position:relative}.header-module--profilePicture--1aaYx{border-radius:50%;overflow:hidden;width:150px}.header-module--profileContent--3G8DP{margin:10px 0 0 50px}.header-module--profileContent--3G8DP h1{color:#1f2933;font-size:45px;letter-spacing:2px;margin:0}.header-module--profileContent--3G8DP h2{font-size:20px;font-weight:400;margin:0 0 30px}@media only screen and (max-width:768px){.header-module--headerWrapper--15qHx{display:block}.header-module--profileWrapper--17Lox{display:block;width:100%}.header-module--profileContent--3G8DP{display:block;margin:25px 0 0;width:100%}}.container-module--wrapper--_zFcw{max-width:1200px;padding:100px;position:relative;width:100%}@media only screen and (max-width:768px){.container-module--wrapper--_zFcw{padding:50px}}.layout-module--blobMain--3VKey{position:fixed;top:-150px;right:-700px;z-index:-1}.layout-module--blobMain--3VKey svg{width:1300px;height:1300px;opacity:.5}.layout-module--blobSecondary--1ryDs{position:fixed;top:-250px;right:-750px;z-index:-1}.layout-module--blobSecondary--1ryDs svg{width:1500px;opacity:.1;height:1500px}@media only screen and (max-width:1200px){.layout-module--blobMain--3VKey{opacity:.3}.layout-module--blobSecondary--1ryDs{opacity:.5}}@media only screen and (max-width:768px){.layout-module--blobMain--3VKey{display:none}.layout-module--blobSecondary--1ryDs{opacity:.5}}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}*,:after,:before{box-sizing:inherit}html{background:#fff;color:#52606d;font-size:15px;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;box-sizing:border-box}body{font-family:Heebo,sans-serif;font-size:1em;line-height:1.25;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img{max-width:100%}p{color:#3b3942;font-size:18px;line-height:1.5;margin:0 0 30px}.section-module--wrapper--1PJu9{display:flex;flex-direction:row;margin-bottom:50px}.section-module--left--4Dzzx{width:300px}.section-module--right--3Zh5J{flex:1 1;max-width:700px}.section-module--title--3LB2K{color:#787a82;font-size:14px;font-weight:400;margin:0 0 30px;letter-spacing:3px;text-transform:uppercase}@media only screen and (max-width:768px){.section-module--wrapper--1PJu9{display:block}.section-module--left--4Dzzx,.section-module--right--3Zh5J{display:block;width:100%}}</style><meta name="generator" content="Gatsby 2.20.12"/><title data-react-helmet="true"></title><link rel="icon" href="/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link as="script" rel="preload" href="/webpack-runtime-0b50f9570993c6abadee.js"/><link as="script" rel="preload" href="/styles-36681512479a843831b0.js"/><link as="script" rel="preload" href="/framework-f0b1095636d7eea85476.js"/><link as="script" rel="preload" href="/app-ca555245858a95559653.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-73775516be0a70cb8be3.js"/><link as="fetch" rel="preload" href="/page-data/blog/cube/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="blog-post-container" style="margin-left:0%;margin-right:0%"><div class="blog-post"><h1>Reaction Wheel Cube</h1><h2>May 02, 2019</h2><div class="blog-post-content"><p>I thought since I'm now locked down because of the coronavirus that I would start a new project. I was quite fascinated with the cubli [LINK], it's amazing how well tuned it is, but the part that impressed me the most was how quickly it rejected disturbances and re-stabilized. Over the last few weeks I've gotten started, and I've gotten a good amount done, but this will be done it parts as it will be quite a long project.</p>
<h2>The Motor</h2>
<p>I thought I would start with the motor, since without that I couldn't really design much of anything outside of the Accelerometer/Gyro. I know in the real Cubli that they used brushed motors, but I wanted to avoid that for a couple of reasons. First, the kind of brushed motors they used were very expensive because of the rare earth magnets used in them, and secondly, I wanted to try building my own encoder for a brushless motor. </p>
<h2>The Encoder</h2>
<p>This is the first big hurdle in the project. Most commercial ESC's use back EMF to determine the position of a brushless motor. That won't work here because I'm going to need to be able to drive the motor at slow speeds (you can't easily do this with backEMF because the slower a brushless motor goes the more current it takes to drive, making it very hard to detect the back EMF). I also need to reverse, which is a problem with back EMF because you obviously have to go slow before you reverse. For these reasons I went with Hall Sensors. They should detect the position of the rotor regardless of its speed, position, or direction, but they will be quite a bit harder to set up.</p>
<p><strong>Design</strong>
This is the design I settled on, my motor is a 14 magnet 12 stator motor, so I placed the hall sensors 60 degrees apart. The middle sensor will be in front of a stator wound in reverse, so I'm using bipolar hall sensors with a comparator to output a digital signal for my microcontroller. This way, regardless of the windings I can use the same hall sensors without flipping them around.</p>
<p>[PICS OF HALLBOARD]</p>
<p>I used the following code just to verify that it was all working nicely, this is the output as I rotate the motor by hand.</p>
<p>This was harder than I expected to set up, so I figured I'd go through the problems I had in case anyone is doing something similar.</p>
<ol>
<li>I started this by milling PCBs on a CNC machine, but using through hole components meant that I couldn't exactly align the hall sensors every time. This offset caused my controller to switch magnets at (slightly) incorrect times, leading to a huge increase in heat as well as increased current draw. This was fixed by using SMD components. Applying solder paste and reflowing all the components onto the board made a huge difference in heat and current draw.</li>
<li>My power supply was insufficient. I have a 30V 5A max variable power supply that I was testing on, however I noticed the power to the microcontroller was dipping significantly when the motor was running slower. This led to the microcontroller outputting insufficient voltage to the ESC, only partially opening the MOSFETS and causing one to heat up very quickly and explode. This was fixed by testing on a LIPO battery, which has much higher burst currents and allows me to slow the motor much more without excess heat.</li>
<li>To test, I simply de-soldered the Atmega8a chip on the ESC and soldered my own wires to the pins that controlled the MOSFETS (more on this later). This allowed me to control the motor without building my own ESC, but it is not very clean. I may attempt to build my own ESC for this later on. The advantage of this however is that if it does not work, you know that the problem is with your setup, and not the ESC itself.</li>
</ol>
<h2>The ESC</h2>
<p>As I said earlier, I used a multimeter to determine which pins of the Atmega8a were controlling the MOSFETS, and soldered my own wires to them to control the ESC externally. This is what that setup looks like:</p>
<p>[ESC PICS]</p>
<p>The ESC also has an UBEC which I am using to power the arduino. It may be better to switch this to an external power supply while i'm testing because big fluctuations could damage the MOSFETS as they did before. The ESC sits on a pair of standoffs on a 3d printed mount.</p>
<h2>State of the project</h2>
<p>Currently, I am able to control the speed of the motor. I can make it go slow, fast, and in reverse. This is a significant part of the project so hopefully I'll be able to get working on some code soon.</p>
<p>For now, this is the roadmap for the project:</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/cube";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ca555245858a95559653.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-73775516be0a70cb8be3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-8665a0d555297cf4547b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9e0ad62bd70217eca477.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-c7ba64cbc10b947bcf08.js"]};/*]]>*/</script><script src="/component---src-templates-blog-template-js-73775516be0a70cb8be3.js" async=""></script><script src="/app-ca555245858a95559653.js" async=""></script><script src="/framework-f0b1095636d7eea85476.js" async=""></script><script src="/styles-36681512479a843831b0.js" async=""></script><script src="/webpack-runtime-0b50f9570993c6abadee.js" async=""></script></body></html>