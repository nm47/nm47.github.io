{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/Melzi","result":{"data":{"markdownRemark":{"html":"<p>Back in 2016, I got a 3d printer, the moniprice maker select v2.1. But not until years later did I realize that the firmware on the stock \"Melzi\" board did not have thermal runaway protection. This meant that if the thermistor in the hotend ever died, it would report 0 degrees, and the hotend would get hotter and hotter until it would very likely catch fire. I set out to fix it before I printed anything else.</p>\n<p><strong>New Firmware</strong><br>\nI decided to install the marlin firmware <a href=\"http://marlinfw.org/meta/download/\">found here,</a> and while it was not built exactly for my printer, it only took a few modifications (shown below) till it was ready to be uploaded.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\">Line <span class=\"token number\">122</span><span class=\"token operator\">:</span> #define MOTHERBOARD BOARD_MELZI\n\nLine <span class=\"token number\">140</span><span class=\"token operator\">:</span> #define DEFAULT_NOMINAL_FILAMENT_DIA <span class=\"token number\">1.75</span>\n\nLine <span class=\"token operator\">~</span><span class=\"token number\">290</span><span class=\"token operator\">:</span> \n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_0 <span class=\"token number\">1</span>    <span class=\"token operator\">|</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_1 <span class=\"token number\">0</span>    <span class=\"token operator\">|</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_2 <span class=\"token number\">0</span>    <span class=\"token operator\">|</span> I only have one thermister<span class=\"token punctuation\">,</span> so we only need SENSOR_0</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_3 <span class=\"token number\">0</span>    <span class=\"token operator\">|</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_4 <span class=\"token number\">0</span>    <span class=\"token operator\">|</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">TEMP_SENSOR_BED <span class=\"token number\">1</span>  <span class=\"token operator\">|</span></span></span>\n\nLine <span class=\"token operator\">~</span><span class=\"token number\">517</span><span class=\"token operator\">:</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">X_MIN_ENDSTOP_INVERTING <span class=\"token boolean\">true</span>  </span><span class=\"token comment\">// true to invert the logic of the endstop.</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">Y_MIN_ENDSTOP_INVERTING <span class=\"token boolean\">true</span>  </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">Z_MIN_ENDSTOP_INVERTING <span class=\"token boolean\">true</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">X_MAX_ENDSTOP_INVERTING <span class=\"token boolean\">false</span> </span><span class=\"token comment\">// false, this one was fine</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">Y_MAX_ENDSTOP_INVERTING <span class=\"token boolean\">false</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">Z_MAX_ENDSTOP_INVERTING <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">Z_MIN_PROBE_ENDSTOP_INVERTING </span><span class=\"token comment\">// I don't have a probe for my printer. </span></span>\n\nLine <span class=\"token operator\">~</span><span class=\"token number\">550</span><span class=\"token operator\">:</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_AXIS_STEPS_PER_UNIT   <span class=\"token punctuation\">{</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">94</span> <span class=\"token punctuation\">}</span> </span><span class=\"token comment\">//settings found in my printer documentation</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_MAX_FEEDRATE          <span class=\"token punctuation\">{</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">25</span> <span class=\"token punctuation\">}</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_MAX_ACCELERATION      <span class=\"token punctuation\">{</span> <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span> <span class=\"token punctuation\">}</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_ACCELERATION          <span class=\"token number\">700</span>   </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_RETRACT_ACCELERATION  <span class=\"token number\">2000</span> </span><span class=\"token comment\">// I wanted it relatively slow to avoid extrusion problems. </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_TRAVEL_ACCELERATION   <span class=\"token number\">700</span>  </span><span class=\"token comment\">// Slow to avoid ghosting.  </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_XJERK                  <span class=\"token number\">8.0</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_YJERK                  <span class=\"token number\">8.0</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_ZJERK                  <span class=\"token number\">0.4</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DEFAULT_EJERK                  <span class=\"token number\">5.0</span></span></span>\n\nLine  <span class=\"token operator\">~</span><span class=\"token number\">773</span><span class=\"token operator\">:</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_X_DIR <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_Y_DIR <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_Z_DIR <span class=\"token boolean\">true</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_E0_DIR <span class=\"token boolean\">true</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_E1_DIR <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_E2_DIR <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_E3_DIR <span class=\"token boolean\">false</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">INVERT_E4_DIR <span class=\"token boolean\">false</span></span></span>\n\nLine <span class=\"token operator\">~</span><span class=\"token number\">814</span><span class=\"token operator\">:</span> #define Z_MAX_POS <span class=\"token number\">190</span> <span class=\"token comment\">//with z supports reducing my z height, 190 is my new max height</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Unfortunately, the Melzi board does not have a bootloader, and therefore you cannot simply flash any firmware you want. </p>\n<h2>Bootloader</h2>\n<p>The Melzi board seems to be a derivative of the sanguino, which makes it pretty easy to use an arduino uno as a middle man <a href=\"https://github.com/Lauszus/Sanguino\">using this library</a> to flash a firmware to the Melzi.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; margin-left:0\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/181680bd1c2527516608074c919a46db/5af3f/Melzi-SPI.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB8zTClamUkigydJ//xAAeEAABAwQDAAAAAAAAAAAAAAACAQMRABIiQiExMv/aAAgBAQABBQKMhgFbLiaNZbaXHZZtDrY/aV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAACAgIDAAAAAAAAAAAAAAABEAARAiEicYH/2gAIAQEABj8CmJrkDD2tun4v/8QAHRAAAwACAgMAAAAAAAAAAAAAAAERITFBUXGBsf/aAAgBAQABPyGWUzZQbLsLKt6Y9D7MRVfI5S1dEL1jT2PkW+SMXB//2gAMAwEAAgADAAAAEPgq/f/EABgRAQEAAwAAAAAAAAAAAAAAAAEQESFB/9oACAEDAQE/EA7A1mf/xAAWEQADAAAAAAAAAAAAAAAAAAABIDH/2gAIAQIBAT8QMT//xAAdEAEAAgMBAAMAAAAAAAAAAAABABEhMUFRYXHw/9oACAEBAAE/EKizZCYAPFuw8hFkFSkiIM51XP1Bmp4mtMUjL7fgmb6BodgAyZQplmP5RHDTYKh0vVprKbgcz//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Melzi.jpg\"\n        title=\"Melzi.jpg\"\n        src=\"/static/181680bd1c2527516608074c919a46db/9d361/Melzi-SPI.jpg\"\n        srcset=\"/static/181680bd1c2527516608074c919a46db/8f721/Melzi-SPI.jpg 200w,\n/static/181680bd1c2527516608074c919a46db/81a96/Melzi-SPI.jpg 400w,\n/static/181680bd1c2527516608074c919a46db/9d361/Melzi-SPI.jpg 800w,\n/static/181680bd1c2527516608074c919a46db/ca9b4/Melzi-SPI.jpg 1200w,\n/static/181680bd1c2527516608074c919a46db/9d9f1/Melzi-SPI.jpg 1600w,\n/static/181680bd1c2527516608074c919a46db/5af3f/Melzi-SPI.jpg 3456w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Here is a picture of the main board. You can see the heatsinks for the stepper drivers across the top. I have plans to replace the drivers with TMC2226 stepper drivers\nin the future as I've wanted to mess with those for a while. That's something for another post though.</p>","frontmatter":{"date":"May 02, 2019","path":"/blog/Melzi","title":"Replacing Stock Melzi Firmware on MMS V2.1"}}},"pageContext":{}},"staticQueryHashes":["63159454"]}