{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/RFSocket","result":{"data":{"markdownRemark":{"html":"<p>For Christmas this year we got radio controlled sockets for our christmas lights, because all the lights are plugged in on opposite sides of the house as well as outside. When christmas ended I decided to use these sockets for the T.V. and lamps. It was pretty annoying having to use the remote though, so I had the idea to build a simple website to automate the house.</p>\n<h2>The Raspberry Pi</h2>\n<p>I started with a raspberry pi, and 433Mhz RF emitter and receiver modules, but the obvious problem was that I had nothing to send to the sockets. I had seen this done with other types of sockets, but I couldn't find any available protocols online for the sockets that we had, so I decided to record them myself.</p>\n<h2>The Receiver Setup</h2>\n<p>To record the signal, I used a raspberry pi to provide 5v for the RF receiver, and simply sent the recieved signal into the line-in jack of my computer. The only complication was that the line-in expected only 1.23v, while my rf receiver outputs 5v, so I made a simple voltage diveder (schematic pictured) to drop the voltage to around 1v which worked fine without blowing out my sound card. I used resistors i had on hand that were 4700 ohm, and 1000 ohm.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 350px; margin-left:0\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/913e0c690643bd1377231188c08a59ab/19034/voltage-divider.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9NQKEDQP/EABgQAAMBAQAAAAAAAAAAAAAAAAABEBEx/9oACAEBAAEFAsEaouRT/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBAAAQMFAAAAAAAAAAAAAAAAAQAQIREgMUFx/9oACAEBAAE/IeiiiTKqbFtg3//aAAwDAQACAAMAAAAQ48gA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHhAAAgICAgMAAAAAAAAAAAAAAREhMQAQQbFRYYH/2gAIAQEAAT8QCBC/kvK4pEX7wVDKIOgSNyZ+4h413nvX/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"NO IMAGE ):\"\n        title=\"NO IMAGE ):\"\n        src=\"/static/913e0c690643bd1377231188c08a59ab/19034/voltage-divider.jpg\"\n        srcset=\"/static/913e0c690643bd1377231188c08a59ab/8f721/voltage-divider.jpg 200w,\n/static/913e0c690643bd1377231188c08a59ab/19034/voltage-divider.jpg 350w\"\n        sizes=\"(max-width: 350px) 100vw, 350px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The audio was then recorded with audacity, where I manually converted the signal to ones and zeroes. </p>\n<h2>The Emitter</h2>\n<p>This was the easiest part, after recording and transcribing all of the signals, all I had to do was write a little script to send them. I found that I had to send each code twice to reliably toggle each socket, and it seems that like original remote was doing that itself as well. I suppose it's just more reliable to send everything twice.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-cpp line-numbers\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">SendCode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> szCode<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   timespec sleeptime<span class=\"token punctuation\">;</span>\n   timespec remtime<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> delay<span class=\"token punctuation\">;</span>\n   delay <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n     <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> iSend <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span> iSend <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">;</span> iSend<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">{</span>\n      sleeptime<span class=\"token punctuation\">.</span>tv_sec <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      sleeptime<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">=</span> delay <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// value obtained by trial and error to match transmitter</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>szCode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>szCode<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">{</span>\n              GPIO_SET <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">else</span>\n          <span class=\"token punctuation\">{</span>\n              GPIO_CLR <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token function\">nanosleep</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>sleeptime<span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>remtime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      sleeptime<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">=</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//10ms</span>\n      <span class=\"token function\">nanosleep</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>sleeptime<span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>remtime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"date":"January 20, 2015","path":"/blog/RFSocket","title":"Building an RF Socket Controller"}}},"pageContext":{}},"staticQueryHashes":["63159454"]}